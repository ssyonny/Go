# 웹 기반 보드게임 프로젝트 요구사항

## 1. 프로젝트 개요
- 프로젝트명: 모두를위한바둑
- 설명: 고연령들도 즐길 수 있는 바둑
- 목표: 유저간의 대전과 승급전(AI)를 통해 자신의 실력을 뽐낼 수 있도록

## 2. 게임 규칙 & 메커닉스

### 2.1 기본 규칙
- 한국 바둑 규칙을 따른다.
- 바둑판 크기: 19x19 (정식), 13x13 (속기), 9x9 (입문) 지원
- 덤(Komi): 6.5집 (백에게 부여, 무승부 방지)
- 패(Ko) 규칙: 직전 상태로 되돌리는 착수 금지 (기본 패 규칙 적용)
- 집 계산 방식: 한국식 (순수 집 + 먹은 돌 수)
- 사석 판정: 대국 종료 시 양 플레이어의 합의로 결정, 합의 불일치 시 이어두기로 해결

### 2.2 시간 규정
- 기본 대국 시간: 10분
- 초읽기: 30초 x 3회 (초읽기 잔여 횟수 UI에 표시)
- 초읽기 마지막 1회 진입 시 사전 경고 (시각 + 효과음)
- AI 대국: 동일한 시간 규정 적용 (AI 응답 시간은 대국 시간에서 제외)

### 2.3 게임 메커닉스
- 유저간 대국을 할 수 있다.
- AI와 대국을 할 수 있다.
- 게임중인 유저와 대기중인 유저를 볼 수 있어야 한다.
- 서버에 접속중인 사용자들의 정보를 리더보드로 다른 이들이 볼 수 있어야 한다.
- 재야 1~10단, 중원 1~10단, 고수 1~10단으로 등급을 나눈다.
- 유저간의 대결로 포인트를 쌓아 승급한다.
- 해당 단의 AI와 승급전을 치러 이길 경우 해당 등급을 획득할 수 있다.

### 2.4 매칭 시스템
- 자동 매칭: 등급 ±3단 범위 내에서 대기 중인 상대와 자동 매칭
- 자동 매칭 대기 시간이 30초 이상이면 매칭 범위를 ±5단으로 확장
- 방 생성: 직접 대국 방을 생성하여 특정 상대를 초대할 수 있음
- 바둑판 크기 선택: 방 생성 또는 자동 매칭 시 바둑판 크기를 선택 가능
- 매칭 대기 화면: 대기 중 광고 노출 및 상대 정보 미리보기 표시 (7.1 광고 연동)

### 2.5 승리/패배 조건
- 집의 개수로 승부를 결정한다. (덤 6.5집 포함)
- 상대가 기권을 하면 패배로 처리한다.
- 초읽기를 모두 사용한 뒤 시간이 경과하면 패배한다. (사전 경고 필수)
- 브라우저 종료 후 1분 이내 미접속 시 패배 처리한다.
- 서버 연결 끊김 후 1분 이내 미복구 시 패배 처리한다.

## 3. 기능 요구사항

### 3.1 유저 관리
- [ ] 회원가입
  - 아이디/비밀번호/닉네임으로 회원가입
  - 아이디: 영문+숫자 조합, 4~20자
  - 비밀번호: 영문+숫자+특수문자 포함 8자 이상
  - 닉네임: 2~10자, 중복 불가
- [ ] 로그인/로그아웃
  - JWT 토큰 기반 인증
  - 자동 로그인 (Remember Me) 옵션
- [ ] 프로필 관리
  - 닉네임 변경 (30일 주기 제한)
  - 비밀번호 변경
  - 전적 조회 (승/패/승률, 등급별 통계)
- [ ] 계정 삭제
  - 대국 중에는 삭제 불가
  - 삭제 후 30일간 복구 가능

### 3.2 핵심 게임 기능
- [ ] 게임 플레이
  - 게임 시작/종료
  - 턴 관리 (흑 선공)
  - 게임 상태 관리 (진행중/종료/일시중단)
  - 무르기 요청: 상대방 동의 시 1수 되돌리기 (대국당 3회 제한)
  - 집 계산 및 결과 표시

- [ ] 세션 관리
  - 웹브라우저 종료 후 1분 이내 재접속 시 진행 중인 게임 이어가기
  - 1분 초과 시 패배 처리
  - 서버 연결 끊김 시 1분 내 복구 가능 (초과 시 패배)
  - 1계정 1접속만 허용 (중복 접속 시 기존 세션 종료 확인 알림)

### 3.3 멀티플레이
- [ ] 실시간 동기화
  - Socket.io 기반 양방향 통신
  - 착수 시 상대방 화면에 즉시 반영

- [ ] 채팅 시스템
  - 매크로 채팅: 기본 제공 문구 (예: "좋은 수입니다", "잘 두셨습니다", "잠시만요")
  - 매크로 에디트: 사용자가 기본 매크로 문구를 직접 수정/추가 가능 (최대 10개)
  - 채팅 허락/금지 설정: 대국 시작 전 설정
    - 상대가 채팅을 거부한 경우 채팅 입력창 비활성화 (UI에서 숨김 처리)
    - 매크로만 허용 / 전체 거부 옵션 구분
  - 비속어 필터링: 기본 금칙어 목록 적용

- [ ] 관전 기능
  - 최대 관전자: 게임당 5명
  - 관전자 채팅: 관전 전용 채팅창 (대국자와 분리)
  - 관전자끼리만 채팅 가능 (대국자 방해 방지)
  - 관전자는 매크로 사용 불가
  - 게임 시작 후 언제든 진입, 게임 종료 시 자동 퇴장

### 3.4 AI 대국
- [ ] AI 난이도
  - 등급별 AI 강도 매핑 (재야 1단 ~ 고수 10단, 총 30단계)
  - KataGo의 playout 수 조절로 난이도 구현
    - 재야 1단: 10 playouts, 재야 10단: 100 playouts
    - 중원 1단: 200 playouts, 중원 10단: 2000 playouts
    - 고수 1단: 3000 playouts, 고수 10단: 10000+ playouts
  - 동시 AI 대국 수 제한: 서버당 최대 5게임 (서버 부하 관리)
- [ ] 승급전
  - 현재 등급의 AI와 대국하여 승리 시 해당 등급 획득
  - 승급전 패배 시 포인트 변동 없음 (페널티 없음)
  - 승급전은 19x19 바둑판에서만 가능

### 3.5 UI/UX 기능
- [ ] 게임 보드 시각화 (Canvas 렌더링)
- [ ] 플레이어 정보 표시 (닉네임, 등급, 전적)
- [ ] 게임 상태 표시 (점수, 턴, 타이머, 초읽기 횟수)
- [ ] 반응형 디자인 (최소 지원 해상도: 360x640, 모바일 세로 모드)
- [ ] 착수 시 효과음 및 시각 효과

### 3.6 부가 기능
- [ ] 전적/통계 기록 (승률, 등급 변동 이력, 최근 대국 기록)
- [ ] 대국 기록 저장 및 복기 (SGF 형식으로 저장, 수순 재생 기능)
- [ ] 설정 메뉴 (효과음 ON/OFF, 채팅 설정, 알림 설정)
- [ ] 신고 기능 (부정행위, 비매너 행위 신고 → 관리자 검토)

## 4. 비기능 요구사항
- 성능:
  - 응답 시간 < 500ms
  - 보드 렌더링 60fps 이상
  - 착수 동기화 지연 < 200ms
- 호환성: Chrome, Safari, Edge (최신 2버전)
- 보안:
  - HTTPS/SSL 필수 (배포 환경)
  - 비밀번호: bcrypt로 해싱 (salt rounds: 10)
  - 인증: JWT 토큰 (로그인 후 발급, 유효시간 24시간)
  - CORS: 프론트엔드 도메인만 허용
  - 세션 데이터: Redis 캐시 (게임 상태 저장)
  - 입력값 검증: XSS, SQL Injection 방지
- 확장성:
  - 게임당 동시 플레이어 2명, 관전자 5명
  - 목표 동시 접속자: 100명
  - 동시 진행 게임: 최대 30게임

## 5. 기술 스택
- **Frontend**: React (생태계 풍부, 바둑판 렌더링 라이브러리 다양)
- **Backend**: Node.js + Express (간단하고 빠름, JavaScript 통일)
- **Database**: PostgreSQL (안정성, 무료, 소규모에 적합)
- **Cache**: Redis (세션 관리, 게임 상태 캐싱)
- **Real-time**: Socket.io (WebSocket + 폴백, 사용 용이)
- **렌더링**: Canvas (SVG보다 성능 우수)
- **바둑 엔진**: KataGo (오픈소스, Docker 배포)
- **배포**: Heroku 또는 AWS EC2

## 6. 포인트 & 등급 시스템

### 6.1 포인트 계산 규칙
포인트는 아래 규칙을 **단계적으로** 적용한다 (중복 적용 아님):

| 조건 | 승리 | 패배 |
|------|------|------|
| 기본 (등급 차 1~3단) | +10 | -5 |
| 흑(선수) 보정 | +2 추가 | 변동 없음 |
| 백(후수) 보정 | -2 감소 | 변동 없음 |
| 동등급전 (같은 단) | +5 | -5 |
| 상위급자전 (4단 이상 차이) | +15 | -3 |

- 예시: 재야 3단(흑)이 재야 7단(백)을 이긴 경우 → 상위급자전 +15 + 흑 보정 +2 = **+17포인트**
- 예시: 재야 5단(백)이 재야 5단(흑)에게 진 경우 → 동등급전 -5 (보정 없음) = **-5포인트**

### 6.2 승급/강등
- 승급: 100포인트 도달 시 자동 승급 (포인트 0으로 리셋)
- 강등: 0포인트 이하 시 강등 (강등 후 포인트 50으로 설정)
- 재야 1단 이하로는 강등 불가 (최소 등급)
- 승급전(AI): 승리 시 해당 등급 즉시 획득 (포인트 50으로 시작), 패배 시 포인트 변동 없음

## 7. 수익 모델 (하이브리드)

광고 + 구독 + 소액결제를 결합한 하이브리드 모델을 적용한다.
유저 체류 시간이 길수록 수익이 증가하는 구조를 기반으로 한다.

### 7.1 광고 (1순위 수익원 — 체류 시간 비례)

| 광고 유형 | 노출 위치 | 설명 |
|-----------|-----------|------|
| 배너 광고 | 대기실, 리더보드, 로비 화면 | 체류 시간에 비례하여 노출 증가 |
| **매칭 대기 광고** | 자동 매칭 대기 화면 | 매칭 중 전면 또는 반면 광고 노출 |
| 인터스티셜 광고 | 대국 종료 → 결과 화면 전환 시 | 대국 횟수에 비례 (무료 유저만) |
| 보상형 광고 | 유저 자발적 시청 | 광고 시청 시 보상 지급 |

- **광고 금지 구간**: 대국 진행 중에는 일체 광고를 노출하지 않는다 (UX 보호)
- **매칭 대기 광고 상세**:
  - 매칭 대기 시작 시 화면 하단 50% 영역에 광고 노출, 상단에는 매칭 상태/예상 대기 시간 표시
  - 매칭 완료 시 광고 즉시 종료 → 대국 준비 화면으로 전환
  - 대기 시간이 길수록 광고 노출 시간 증가 (자연스러운 수익 구조)
  - 보상형 광고 선택지 제공: 대기 중 광고 시청 완료 시 보상 지급
- **보상형 광고 보상**:
  - 무르기 +1회 (대국당 1회 한정)
  - 초읽기 +1회 (대국당 1회 한정)
  - AI 대국권 +1회

### 7.2 프리미엄 구독 (2순위 수익원 — 충성 유저 전환)

| 등급 | 월 가격 | 혜택 |
|------|---------|------|
| **무료** | 0원 | 광고 포함, AI 대국 일 3회, 기본 복기 기능 |
| **프리미엄** | 월 3,900원 | 광고 제거, AI 대국 무제한, 대국 복기 무제한, AI 추천수 분석 |
| **프로** | 월 7,900원 | 프리미엄 전체 + 고급 통계, 프로필 꾸미기 아이템, 전용 매크로 슬롯 +5개 |

- 무료 유저의 기능 제한은 불편함이 아닌 "부가 가치 차이"로 설계한다
- 구독 유저 전용 혜택은 게임 승패에 영향을 주지 않는다 (Pay-to-Win 방지)

### 7.3 소액결제 (3순위 수익원 — 비구독자 보완)

| 아이템 | 가격 | 설명 |
|--------|------|------|
| AI 분석 1회 이용권 | 500원 | 대국 종료 후 AI 추천수 분석 1회 |
| 승급전 재도전권 | 300원 | 승급전 패배 후 즉시 재도전 (일 1회 한정) |
| 프로필 아이템 | 100~1,000원 | 바둑돌 스킨, 바둑판 테마, 프로필 테두리 |
| 매크로 슬롯 확장 | 500원 | 매크로 슬롯 +3개 (영구) |

- 모든 소액결제 아이템은 게임 실력과 무관한 꾸미기/편의 아이템으로 한정
- 구독 유저에게는 소액결제 아이템 10% 할인 적용

### 7.4 광고 정책 원칙
- 대국 중 광고 노출 금지
- 보상형 광고는 유저의 자발적 선택으로만 재생
- 고연령 타겟을 고려하여 광고 크기와 닫기 버튼을 크게 설계
- 인터스티셜 광고는 연속 2회 이상 노출하지 않음 (쿨다운 5분)

## 8. 마일스톤
| Phase | 내용 | 예상 기간 |
|-------|------|---------|
| Phase 1 | 기본 구조, 로그인/회원가입, 바둑판 UI | [기간입력] |
| Phase 2 | 바둑 규칙 엔진, 게임 로직 구현 (패, 집 계산, 사석 판정) | [기간입력] |
| Phase 3 | WebSocket, 실시간 동기화, 매칭 시스템, 채팅/매크로 | [기간입력] |
| Phase 4 | AI 엔진 통합 (KataGo), 등급/포인트 시스템, 리더보드 | [기간입력] |
| Phase 5 | 관전, 대국 기록/복기, 신고 기능 | [기간입력] |
| Phase 6 | 수익 모델 구현 (광고 연동, 구독 결제, 소액결제 시스템) | [기간입력] |
| Phase 7 | 테스트, 버그 픽스, 성능 최적화, 배포 | [기간입력] |

## 9. 제약사항
- 웹브라우저로 접속하여 게임을 실행한다.
- 웹브라우저가 닫혔더라도 1분 이내 재접속하면 세션을 유지한다. (1분 초과 시 패배 처리)
- 1계정 1접속만 허용 (중복 접속 불가)
- 게임 중 서버 연결 끊김 시 1분 내 복구 가능 (초과 시 패배)
- 모바일 기기 화면 크기에 맞게 UI 최적화 (반응형 디자인, 최소 360x640)
- AI 대국은 서버당 동시 5게임으로 제한

## 10. 추가 노트

- **개발 시작 전 필수 준비**:
  - KataGo Docker 이미지 사전 구성 및 난이도별 playout 수 테스트
  - PostgreSQL 스키마 및 마이그레이션 도구 설계
  - Socket.io 기반 게임 상태 동기화 프로토콜 정의
  - 바둑 규칙 엔진 테스트 케이스 작성 (특히 집 계산, 패 규칙, 사석 판정)
  - Redis 세션 관리 구조 설계

- **향후 확장 고려 사항** (현재 버전에서는 미구현):
  - 소셜 로그인 (Google, Kakao)
  - 대회/토너먼트 모드
  - 친구 목록 및 초대 기능
  - 기보 분석 (AI 추천수 표시)
